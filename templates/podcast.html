{% extends "base.html" %}

{% block title %}Podcast | BuNker11{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/podcast.css') }}">
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='scripts/lite-yt-embed.js') }}" type="module"></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    const img = document.getElementById('podcast-thumbnail');
    if (!img) return;

    img.onerror = function () {
        const fallback = img.getAttribute('data-fallback');
        if (fallback) {
            img.src = fallback;
        }
    };
});
</script>
{% endblock %}

{% block content %}
<section class="podcast-section">
    <h1>TOT Presents Worthing Podcast</h1>

    <div class="recent-video">
        {% if podcast_url %}
            {% set video_id = podcast_url.split('v=')[-1].split('&')[0] if 'v=' in podcast_url else podcast_url.split('/')[-1] %}
        {% else %}
            {% set video_id = "-3KvXitcFkk" %}
        {% endif %}

        <img
            id="podcast-thumbnail"
            src="https://i.ytimg.com/vi/{{ video_id }}/maxresdefault.jpg"
            data-fallback="https://i.ytimg.com/vi/{{ video_id }}/sddefault.jpg"
            alt="Latest Podcast Video"
            fetchpriority="high"
            decoding="async"
            width="640"
            height="480"
            class="lcp-poster">

        <lite-youtube
            videoid="{{ video_id }}"
            style="--ytimg: url('https://i.ytimg.com/vi/{{ video_id }}/maxresdefault.jpg');"
            data-title="">
            <noscript>
                <a href="https://www.youtube.com/watch?v={{ video_id }}">Watch on YouTube</a>
            </noscript>
        </lite-youtube>
    </div>

    <div class="subscribe-container">
        <a href="https://www.youtube.com/channel/{{ youtube_channel_id }}?sub_confirmation=1" target="_blank" class="subscribe-button">
            Subscribe to TOT Presents Worthing Podcast
        </a>
    </div>

    <div class="video-gallery">
        {% for video in recent_videos %}
        <a href="https://www.youtube.com/watch?v={{ video.id }}" target="_blank" class="video-thumb" title="{{ video.title }}">
            <img src="{{ video.thumbnail }}" alt="{{ video.title }}" loading="lazy">
            <span class="video-title">{{ video.title }}</span>
        </a>
        {% endfor %}
    </div>
</section>
{% endblock %}
